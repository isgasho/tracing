<template>
  <div>
    <Row class="padding-20">
       <Col span="8" style="background:rgb(245, 245, 245)"  class="padding-20 padding-bottom-40">
          <div  class="font-size-18">链路过滤</div>
          <div class="margin-top-10">
            <div class="font-size-16">请求API</div>
            <Select style="width:300px" size="large">
                <Option value="beijing">New York</Option>
                <Option value="shanghai">London</Option>
                <Option value="shenzhen">Sydney</Option>
            </Select>
          </div>
          
          <div class="margin-top-40">
            <div class="font-size-16">最低响应时间</div>
            <Input  placeholder="e.g. 1.2s 100ms 500us" style="width: 300px" size="large" />
          </div>
           <div class="margin-top-40">
            <div class="font-size-16">最大响应时间</div>
            <Input  placeholder="e.g. 3s" style="width: 300px" size="large" />
          </div>
          <div class="margin-top-40">
            <div class="font-size-16">限定搜索数目</div>
            <InputNumber :max="100" :min="1"  :step="5" v-model="resultLimit" style="width: 300px" size="large"></InputNumber>
          </div>
       </Col>
       <Col span="14" offset="1">
        <trace :graphData="JSON.parse(testData)" style='height: 49vh' @selTraces="selectTraces"></trace>
       </Col>
    </Row>

     <div v-show="selectedTraces.length > 0" class="margin-top-10" style="padding-left:20px;padding-right:20px;">
          <span><Tag style="background: rgb(18, 147, 154,.5)" size="large">{{selSucCount}} 成功</Tag> <Tag style="background:rgba(223, 83, 83, .5)" size="large">{{selErrCount}} 错误</Tag></span>
          <span style="float:right" class="no-border">
            <Select style="width:200px"  value="1">
                <Option value="1">时间最近</Option>
                <Option value="2">时间最远</Option>
                <Option value="3">链路最短</Option>
                <Option value="3">链路最长</Option>
            </Select>
          </span>

        <div style="padding-left:10px;padding-right:10px" class="margin-top-20">
          <Table :row-class-name="rowClassName"  :columns="traceLabels" :data="selectedTraces" class="margin-top-15" @on-row-click="showTrace"></Table>
        </div>
        </div>
  </div>   
</template>

<script>
import request from '@/utils/request' 
import trace from './charts/trace'
import axios from "axios";
export default {
  name: 'tracing',
  components: {trace},
  data () {
    return {
      testData: `{"value":{"agentNodeModels":[{"key":"2","text":"agencyBookKeep","source":"TOMCAT","instanceCount":3,"agentSources":{"timeXticks":[1534201,1546201],"traceHis":{"subTitle":"success:3, error:2","traceSeries":[{"name":"success","color":"rgb(18, 147, 154,.5)","data":[{"x":1545200556716,"y":7,"traceId":"yunbaoParkApp3^1545036617750^4217","agentId":"agencyBookKeep3","startTime":"1545200556716","url":"/agencyBookKeep/financialstatementscs/getOneAccountingDataByParams","traceIp":"127.0.0.1"},{"x":1545200953625,"y":8,"traceId":"yunbaoParkApp4^1545036646685^3779","agentId":"agencyBookKeep3","startTime":"1545200953625","url":"/agencyBookKeep/financialstatementscs/getOneAccountingDataByParams","traceIp":"127.0.0.1"},{"x":1545200545413,"y":7,"traceId":"yunbaoParkApp3^1545036617750^4215","agentId":"agencyBookKeep4","startTime":"1545200545413","url":"/agencyBookKeep/financialstatementscs/getAccountingDataByParams","traceIp":"127.0.0.1"}]},{"name":"error","color":"rgba(223, 83, 83, .5)","data":[{"x":1545200556737,"y":4,"traceId":"yunbaoParkApp3^1545036617750^4216","agentId":"agencyBookKeep4","startTime":"1545200556737","url":"/agencyBookKeep/tfPassbalancesheetcs/getOneAccountsReceivableData","traceIp":"127.0.0.1"},{"x":1545200953628,"y":5,"traceId":"yunbaoParkApp3^1545036617750^4226","agentId":"agencyBookKeep4","startTime":"1545200953628","url":"/agencyBookKeep/tfPassbalancesheetcs/getOneAccountsReceivableData","traceIp":"127.0.0.1"}]}]}}},{"key":"1","text":"yunbaoParkApp","source":"TOMCAT","instanceCount":3,"agentSources":{}},{"key":"3","text":"tfPass","source":"MYSQL","instanceCount":1,"agentSources":{}}],"agentLinkModels":[{"from":"1","to":"2","totalCount":5},{"from":"2","to":"3","totalCount":5}],"nowNodeKey":"2"},"success":true,"message":"","code":0}`,
      testTraceData: `{"value":[{"name":"p-0","classStyle":"hand","trClass":"","tdClass":"","method":"Tomcat Servlet Process","params":"/yunbaoParkApp/tfPassBalanceSheetC/getOneAccountsReceivableData","startTimeStr":"17:42:55 394","exec":"33","self":"0","class":"","api":"TOMCAT","agentId":"yunbaoParkApp4","agentName":"yunbaoParkApp","hasChildren":true,"paddingLeft":0},{"name":"p-0-0","classStyle":"info","trClass":"","tdClass":"","method":"REMOTE_ADDRESS","params":"127.0.0.1","startTimeStr":"","exec":"","self":"","class":"","api":"","agentId":"","agentName":"","hasChildren":false,"paddingLeft":20},{"name":"p-0-0","classStyle":"","trClass":"","tdClass":"","method":"invoke(org.apache.catalina.connector.Request request, org.apache.catalina.connector.Response response)","params":"","startTimeStr":"17:42:55 394","exec":"33","self":"0","class":"StandardHostValve","api":"TOMCAT_METHOD","agentId":"yunbaoParkApp4","agentName":"yunbaoParkApp","hasChildren":true,"paddingLeft":20},{"name":"p-0-0-0","classStyle":"info","trClass":"","tdClass":"","method":"http.param","params":"token=f137b0ee205951530633bced8686abc2_9723969","startTimeStr":"","exec":"","self":"","class":"","api":"","agentId":"","agentName":"","hasChildren":false,"paddingLeft":40},{"name":"p-0-0-0","classStyle":"","trClass":"","tdClass":"","method":"execute(org.apache.http.client.methods.HttpUriRequest request)","params":"","startTimeStr":"17:42:55 394","exec":"4","self":"1","class":"CloseableHttpClient","api":"HTTP_CLIENT_4","agentId":"yunbaoParkApp4","agentName":"yunbaoParkApp","hasChildren":true,"paddingLeft":40},{"name":"p-0-0-0-0","classStyle":"","trClass":"","tdClass":"","method":"connect(org.apache.http.HttpClientConnection managedConn, org.apache.http.conn.routing.HttpRoute route, int connectTimeout, org.apache.http.protocol.HttpContext context)","params":"web-passport-vip:80","startTimeStr":"17:42:55 395","exec":"0","self":"0","class":"PoolingHttpClientConnectionManager","api":"HTTP_CLIENT_4","agentId":"yunbaoParkApp4","agentName":"yunbaoParkApp","hasChildren":false,"paddingLeft":60},{"name":"p-0-0-0-0","classStyle":"","trClass":"","tdClass":"","method":"execute(org.apache.http.HttpRequest request, org.apache.http.HttpClientConnection conn, org.apache.http.protocol.HttpContext context)","params":"/passport/getLoginSession","startTimeStr":"17:42:55 395","exec":"3","self":"3","class":"HttpRequestExecutor","api":"HTTP_CLIENT_4","agentId":"yunbaoParkApp4","agentName":"yunbaoParkApp","hasChildren":true,"paddingLeft":60},{"name":"p-0-0-0-0-0","classStyle":"info","trClass":"","tdClass":"","method":"http.entity","params":"appStoken=f137b0ee205951530633bced8686abc2_9723969","startTimeStr":"","exec":"","self":"","class":"","api":"","agentId":"","agentName":"","hasChildren":false,"paddingLeft":80},{"name":"p-0-0-0-0-0","classStyle":"info","trClass":"","tdClass":"","method":"http.status.code","params":"","startTimeStr":"","exec":"","self":"","class":"","api":"","agentId":"","agentName":"","hasChildren":false,"paddingLeft":80},{"name":"p-0-0-0-0-0","classStyle":"info","trClass":"","tdClass":"","method":"http.io","params":"write=1, read=2","startTimeStr":"","exec":"","self":"","class":"","api":"","agentId":"","agentName":"","hasChildren":false,"paddingLeft":80},{"name":"p-0-0-0-0","classStyle":"hand","trClass":"","tdClass":"","method":"Tomcat Servlet Process","params":"/passport/getLoginSession","startTimeStr":"17:42:55 398","exec":"1","self":"0","class":"","api":"TOMCAT","agentId":"passport6","agentName":"passport","hasChildren":true,"paddingLeft":60},{"name":"p-0-0-0-0-0","classStyle":"info","trClass":"","tdClass":"","method":"REMOTE_ADDRESS","params":"127.0.0.1","startTimeStr":"","exec":"","self":"","class":"","api":"","agentId":"","agentName":"","hasChildren":false,"paddingLeft":80},{"name":"p-0-0-0-0-0","classStyle":"","trClass":"","tdClass":"","method":"invoke(org.apache.catalina.connector.Request request, org.apache.catalina.connector.Response response)","params":"","startTimeStr":"17:42:55 398","exec":"1","self":"1","class":"StandardHostValve","api":"TOMCAT_METHOD","agentId":"passport6","agentName":"passport","hasChildren":true,"paddingLeft":80},{"name":"p-0-0-0-0-0-0","classStyle":"info","trClass":"","tdClass":"","method":"http.param","params":"appStoken=f137b0ee205951530633bced8686abc2_9723969","startTimeStr":"","exec":"","self":"","class":"","api":"","agentId":"","agentName":"","hasChildren":false,"paddingLeft":100},{"name":"p-0-0-0-0-0-0","classStyle":"","trClass":"","tdClass":"","method":"doPost(javax.servlet.http.HttpServletRequest request, javax.servlet.http.HttpServletResponse response)","params":"","startTimeStr":"17:42:55 399","exec":"0","self":"0","class":"FrameworkServlet","api":"SPRING","agentId":"passport6","agentName":"passport","hasChildren":true,"paddingLeft":100},{"name":"p-0-0-0-0-0-0-0","classStyle":"","trClass":"","tdClass":"","method":"getLoginSession(java.lang.String appStoken)","params":"","startTimeStr":"17:42:55 399","exec":"0","self":"0","class":"AppTokenController","api":"SPRING_BEAN","agentId":"passport6","agentName":"passport","hasChildren":true,"paddingLeft":120},{"name":"p-0-0-0-0-0-0-0-0","classStyle":"","trClass":"","tdClass":"","method":"getLoginSession(java.lang.String appToken)","params":"","startTimeStr":"17:42:55 399","exec":"0","self":"0","class":"LoginRedisCacheService","api":"SPRING_BEAN","agentId":"passport6","agentName":"passport","hasChildren":true,"paddingLeft":140},{"name":"p-0-0-0-0-0-0-0-0-0","classStyle":"","trClass":"","tdClass":"","method":"getDB()","params":"write=0, read=0","startTimeStr":"17:42:55 399","exec":"0","self":"0","class":"BinaryJedis","api":"REDIS","agentId":"passport6","agentName":"passport","hasChildren":false,"paddingLeft":160},{"name":"p-0-0-0-0-0-0-0-0-0","classStyle":"","trClass":"","tdClass":"","method":"get(java.lang.String key)","params":"write=0, read=0","startTimeStr":"17:42:55 399","exec":"0","self":"0","class":"Jedis","api":"REDIS","agentId":"passport6","agentName":"passport","hasChildren":false,"paddingLeft":160},{"name":"p-0-0-0-0-0-0-0-0-0","classStyle":"","trClass":"","tdClass":"","method":"resetState()","params":"write=0, read=0","startTimeStr":"17:42:55 399","exec":"0","self":"0","class":"BinaryJedis","api":"REDIS","agentId":"passport6","agentName":"passport","hasChildren":false,"paddingLeft":160},{"name":"p-0-0-0","classStyle":"","trClass":"","tdClass":"","method":"doPost(javax.servlet.http.HttpServletRequest request, javax.servlet.http.HttpServletResponse response)","params":"","startTimeStr":"17:42:55 398","exec":"29","self":"1","class":"FrameworkServlet","api":"SPRING","agentId":"yunbaoParkApp4","agentName":"yunbaoParkApp","hasChildren":true,"paddingLeft":40},{"name":"p-0-0-0-0","classStyle":"","trClass":"","tdClass":"","method":"getOneAccountsReceivableData()","params":"","startTimeStr":"17:42:55 398","exec":"28","self":"1","class":"TfPassBalanceSheetController","api":"SPRING_BEAN","agentId":"yunbaoParkApp4","agentName":"yunbaoParkApp","hasChildren":true,"paddingLeft":60},{"name":"p-0-0-0-0-0","classStyle":"","trClass":"","tdClass":"","method":"execute(org.apache.http.client.methods.HttpUriRequest request)","params":"","startTimeStr":"17:42:55 399","exec":"3","self":"1","class":"CloseableHttpClient","api":"HTTP_CLIENT_4","agentId":"yunbaoParkApp4","agentName":"yunbaoParkApp","hasChildren":true,"paddingLeft":80},{"name":"p-0-0-0-0-0-0","classStyle":"","trClass":"","tdClass":"","method":"execute(org.apache.http.HttpRequest request, org.apache.http.HttpClientConnection conn, org.apache.http.protocol.HttpContext context)","params":"/passport/getLoginSession","startTimeStr":"17:42:55 400","exec":"2","self":"2","class":"HttpRequestExecutor","api":"HTTP_CLIENT_4","agentId":"yunbaoParkApp4","agentName":"yunbaoParkApp","hasChildren":true,"paddingLeft":100},{"name":"p-0-0-0-0-0-0-0","classStyle":"info","trClass":"","tdClass":"","method":"http.entity","params":"appStoken=f137b0ee205951530633bced8686abc2_9723969","startTimeStr":"","exec":"","self":"","class":"","api":"","agentId":"","agentName":"","hasChildren":false,"paddingLeft":120},{"name":"p-0-0-0-0-0-0-0","classStyle":"info","trClass":"","tdClass":"","method":"http.status.code","params":"","startTimeStr":"","exec":"","self":"","class":"","api":"","agentId":"","agentName":"","hasChildren":false,"paddingLeft":120},{"name":"p-0-0-0-0-0-0-0","classStyle":"info","trClass":"","tdClass":"","method":"http.io","params":"write=0, read=2","startTimeStr":"","exec":"","self":"","class":"","api":"","agentId":"","agentName":"","hasChildren":false,"paddingLeft":120},{"name":"p-0-0-0-0-0-0","classStyle":"hand","trClass":"","tdClass":"","method":"Tomcat Servlet Process","params":"/passport/getLoginSession","startTimeStr":"17:42:55 407","exec":"1","self":"0","class":"","api":"TOMCAT","agentId":"passport4","agentName":"passport","hasChildren":true,"paddingLeft":100},{"name":"p-0-0-0-0-0-0-0","classStyle":"info","trClass":"","tdClass":"","method":"REMOTE_ADDRESS","params":"127.0.0.1","startTimeStr":"","exec":"","self":"","class":"","api":"","agentId":"","agentName":"","hasChildren":false,"paddingLeft":120},{"name":"p-0-0-0-0-0-0-0","classStyle":"","trClass":"","tdClass":"","method":"invoke(org.apache.catalina.connector.Request request, org.apache.catalina.connector.Response response)","params":"","startTimeStr":"17:42:55 407","exec":"1","self":"0","class":"StandardHostValve","api":"TOMCAT_METHOD","agentId":"passport4","agentName":"passport","hasChildren":true,"paddingLeft":120},{"name":"p-0-0-0-0-0-0-0-0","classStyle":"info","trClass":"","tdClass":"","method":"http.param","params":"appStoken=f137b0ee205951530633bced8686abc2_9723969","startTimeStr":"","exec":"","self":"","class":"","api":"","agentId":"","agentName":"","hasChildren":false,"paddingLeft":140},{"name":"p-0-0-0-0-0-0-0-0","classStyle":"","trClass":"","tdClass":"","method":"doPost(javax.servlet.http.HttpServletRequest request, javax.servlet.http.HttpServletResponse response)"， 
      "params":"","startTimeStr":"17:42:55 407","exec":"1","self":"1","class":"FrameworkServlet","api":"SPRING","agentId":"passport4","agentName":"passport","hasChildren":true,"paddingLeft":140},{"name":"p-0-0-0-0-0-0-0-0-0","classStyle":"","trClass":"","tdClass":"","method":"getLoginSession(java.lang.String appStoken)","params":"","startTimeStr":"17:42:55 407","exec":"0","self":"0","class":"AppTokenController","api":"SPRING_BEAN","agentId":"passport4","agentName":"passport","hasChildren":true,"paddingLeft":160},{"name":"p-0-0-0-0-0-0-0-0-0-0","classStyle":"","trClass":"","tdClass":"","method":"getLoginSession(java.lang.String appToken)","params":"","startTimeStr":"17:42:55 407","exec":"0","self":"0","class":"LoginRedisCacheService","api":"SPRING_BEAN","agentId":"passport4","agentName":"passport","hasChildren":true,"paddingLeft":180},{"name":"p-0-0-0-0-0-0-0-0-0-0-0","classStyle":"","trClass":"","tdClass":"","method":"getDB()","params":"write=0, read=0","startTimeStr":"17:42:55 407","exec":"0","self":"0","class":"BinaryJedis","api":"REDIS","agentId":"passport4","agentName":"passport","hasChildren":false,"paddingLeft":200},{"name":"p-0-0-0-0-0-0-0-0-0-0-0","classStyle":"","trClass":"","tdClass":"","method":"get(java.lang.String key)","params":"write=0, read=0","startTimeStr":"17:42:55 407","exec":"0","self":"0","class":"Jedis","api":"REDIS","agentId":"passport4","agentName":"passport","hasChildren":false,"paddingLeft":200},{"name":"p-0-0-0-0-0-0-0-0-0-0-0","classStyle":"","trClass":"","tdClass":"","method":"resetState()","params":"write=0, read=0","startTimeStr":"17:42:55 407","exec":"0","self":"0","class":"BinaryJedis","api":"REDIS","agentId":"passport4","agentName":"passport","hasChildren":false,"paddingLeft":200},{"name":"p-0-0-0-0-0","classStyle":"","trClass":"","tdClass":"","method":"getOneAccountsReceivableData(java.util.Map map, tf56.site.domain.SessionBean sessionBean)","params":"","startTimeStr":"17:42:55 402","exec":"24","self":"0","class":"TfPassBalanceSheetService","api":"SPRING_BEAN","agentId":"yunbaoParkApp4","agentName":"yunbaoParkApp","hasChildren":true,"paddingLeft":80},{"name":"p-0-0-0-0-0-0","classStyle":"","trClass":"","tdClass":"","method":"selectCompanyByPartyid(tf56.site.domain.SessionBean sessionBean)","params":"","startTimeStr":"17:42:55 402","exec":"7","self":"1","class":"LogisticsCompanyService","api":"SPRING_BEAN","agentId":"yunbaoParkApp4","agentName":"yunbaoParkApp","hasChildren":true,"paddingLeft":100},{"name":"p-0-0-0-0-0-0-0","classStyle":"","trClass":"","tdClass":"","method":"execute(org.apache.http.client.methods.HttpUriRequest request)","params":"","startTimeStr":"17:42:55 403","exec":"6","self":"0","class":"CloseableHttpClient","api":"HTTP_CLIENT_4","agentId":"yunbaoParkApp4","agentName":"yunbaoParkApp","hasChildren":true,"paddingLeft":120},{"name":"p-0-0-0-0-0-0-0-0","classStyle":"","trClass":"","tdClass":"","method":"connect(org.apache.http.HttpClientConnection managedConn, org.apache.http.conn.routing.HttpRoute route, int connectTimeout, org.apache.http.protocol.HttpContext context)","params":"mt-invoiceApi-vip:80","startTimeStr":"17:42:55 403","exec":"1","self":"1","class":"PoolingHttpClientConnectionManager","api":"HTTP_CLIENT_4","agentId":"yunbaoParkApp4","agentName":"yunbaoParkApp","hasChildren":false,"paddingLeft":140},{"name":"p-0-0-0-0-0-0-0-0","classStyle":"","trClass":"","tdClass":"","method":"execute(org.apache.http.HttpRequest request, org.apache.http.HttpClientConnection conn, org.apache.http.protocol.HttpContext context)","params":"/invoiceApi/logisticmanagecs/selectCompanyByPartyid","startTimeStr":"17:42:55 404","exec":"5","self":"5","class":"HttpRequestExecutor","api":"HTTP_CLIENT_4","agentId":"yunbaoParkApp4","agentName":"yunbaoParkApp","hasChildren":true,"paddingLeft":140},{"name":"p-0-0-0-0-0-0-0-0-0","classStyle":"info","trClass":"","tdClass":"","method":"http.entity","params":"partyid=9723969","startTimeStr":"","exec":"","self":"","class":"","api":"","agentId":"","agentName":"","hasChildren":false,"paddingLeft":160},{"name":"p-0-0-0-0-0-0-0-0-0","classStyle":"info","trClass":"","tdClass":"","method":"http.status.code","params":"","startTimeStr":"","exec":"","self":"","class":"","api":"","agentId":"","agentName":"","hasChildren":false,"paddingLeft":160},{"name":"p-0-0-0-0-0-0-0-0-0","classStyle":"info","trClass":"","tdClass":"","method":"http.io","params":"write=0, read=4","startTimeStr":"","exec":"","self":"","class":"","api":"","agentId":"","agentName":"","hasChildren":false,"paddingLeft":160},{"name":"p-0-0-0-0-0-0-0-0","classStyle":"hand","trClass":"","tdClass":"","method":"api not fount:2","params":"/invoiceApi/logisticmanagecs/selectCompanyByPartyid","startTimeStr":"17:42:55 404","exec":"3","self":"0","class":"","api":"TOMCAT","agentId":"invoiceApi5","agentName":"invoiceApi","hasChildren":true,"paddingLeft":140},{"name":"p-0-0-0-0-0-0-0-0-0","classStyle":"info","trClass":"","tdClass":"","method":"REMOTE_ADDRESS","params":"127.0.0.1","startTimeStr":"","exec":"","self":"","class":"","api":"","agentId":"","agentName":"","hasChildren":false,"paddingLeft":160},{"name":"p-0-0-0-0-0-0-0-0-0","classStyle":"","trClass":"","tdClass":"","method":"api not fount:1","params":"","startTimeStr":"17:42:55 404","exec":"3","self":"1","class":"","api":"TOMCAT_METHOD","agentId":"invoiceApi5","agentName":"invoiceApi","hasChildren":true,"paddingLeft":160},{"name":"p-0-0-0-0-0-0-0-0-0-0","classStyle":"info","trClass":"","tdClass":"","method":"http.param","params":"partyid=9723969","startTimeStr":"","exec":"","self":"","class":"","api":"","agentId":"","agentName":"","hasChildren":false,"paddingLeft":180},{"name":"p-0-0-0-0-0-0-0-0-0-0","classStyle":"","trClass":"","tdClass":"","method":"api not fount:182","params":"","startTimeStr":"17:42:55 405","exec":"2","self":"0","class":"","api":"SPRING_BEAN","agentId":"invoiceApi5","agentName":"invoiceApi","hasChildren":true,"paddingLeft":180},{"name":"p-0-0-0-0-0-0-0-0-0-0-0","classStyle":"","trClass":"","tdClass":"","method":"api not fount:47","params":"","startTimeStr":"17:42:55 405","exec":"2","self":"0","class":"","api":"SPRING_BEAN","agentId":"invoiceApi5","agentName":"invoiceApi","hasChildren":true,"paddingLeft":200},{"name":"p-0-0-0-0-0-0-0-0-0-0-0-0","classStyle":"","trClass":"","tdClass":"","method":"api not fount:204","params":"StringMetaData not Found:2","startTimeStr":"17:42:55 405","exec":"2","self":"0","class":"","api":"IBATIS","agentId":"invoiceApi5","agentName":"invoiceApi","hasChildren":true,"paddingLeft":220},{"name":"p-0-0-0-0-0-0-0-0-0-0-0-0-0","classStyle":"","trClass":"","tdClass":"","method":"api not fount:201","params":"","startTimeStr":"17:42:55 405","exec":"1","self":"0","class":"","api":"DBCP","agentId":"invoiceApi5","agentName":"invoiceApi","hasChildren":true,"paddingLeft":240},{"name":"p-0-0-0-0-0-0-0-0-0-0-0-0-0-0","classStyle":"","trClass":"","tdClass":"","method":"api not fount:-233","params":"true","startTimeStr":"17:42:55 405","exec":"1","self":"1","class":"","api":"MYSQL","agentId":"invoiceApi5","agentName":"invoiceApi","hasChildren":false,"paddingLeft":260},{"name":"p-0-0-0-0-0-0-0-0-0-0-0-0-0","classStyle":"","trClass":"","tdClass":"","method":"api not fount:228","params":"","startTimeStr":"17:42:55 406","exec":"0","self":"0","class":"","api":"MYSQL","agentId":"invoiceApi5","agentName":"invoiceApi","hasChildren":true,"paddingLeft":240},{"name":"p-0-0-0-0-0-0-0-0-0-0-0-0-0-0","classStyle":"sql","trClass":"","tdClass":"","method":"SQL-ID","params":"SQL-ID not found sqlId:-6","startTimeStr":"","exec":"","self":"","class":"","api":"","agentId":"","agentName":"","hasChildren":false,"paddingLeft":260},{"name":"p-0-0-0-0-0-0-0-0-0-0-0-0-0","classStyle":"","trClass":"","tdClass":"","method":"api not fount:234","params":"","startTimeStr":"17:42:55 406","exec":"1","self":"1","class":"","api":"MYSQL","agentId":"invoiceApi5","agentName":"invoiceApi","hasChildren":true,"paddingLeft":240},{"name":"p-0-0-0-0-0-0-0-0-0-0-0-0-0-0","classStyle":"sql","trClass":"","tdClass":"","method":"SQL-ID","params":"SQL-ID not found sqlId:-6","startTimeStr":"","exec":"","self":"","class":"","api":"","agentId":"","agentName":"","hasChildren":false,"paddingLeft":260},{"name":"p-0-0-0-0-0-0-0-0-0-0-0-0-0-0","classStyle":"info","trClass":"","tdClass":"","method":"SQL-BindValue","params":"9723969, 1","startTimeStr":"","exec":"","self":"","class":"","api":"","agentId":"","agentName":"","hasChildren":false,"paddingLeft":260},{"name":"p-0-0-0-0-0-0-0-0-0-0-0-0-0","classStyle":"","trClass":"","tdClass":"","method":"api not fount:238","params":"","startTimeStr":"17:42:55 407","exec":"0","self":"0","class":"","api":"DBCP","agentId":"invoiceApi5","agentName":"invoiceApi","hasChildren":false,"paddingLeft":240},{"name":"p-0-0-0-0-0-0","classStyle":"","trClass":"","tdClass":"","method":"fromObject(java.lang.Object object)","params":"","startTimeStr":"17:42:55 409","exec":"0","self":"0","class":"JSONObject","api":"JSON-LIB","agentId":"yunbaoParkApp4","agentName":"yunbaoParkApp","hasChildren":false,"paddingLeft":100},{"name":"p-0-0-0-0-0-0","classStyle":"","trClass":"","tdClass":"","method":"execute(org.apache.http.client.methods.HttpUriRequest request)","params":"","startTimeStr":"17:42:55 409","exec":"17","self":"1","class":"CloseableHttpClient","api":"HTTP_CLIENT_4","agentId":"yunbaoParkApp4","agentName":"yunbaoParkApp","hasChildren":true,"paddingLeft":100},{"name":"p-0-0-0-0-0-0-0","classStyle":"","trClass":"","tdClass":"","method":"connect(org.apache.http.HttpClientConnection managedConn, org.apache.http.conn.routing.HttpRoute route, int connectTimeout, org.apache.http.protocol.HttpContext context)","params":"web-agencyBookKeep-vip:80","startTimeStr":"17:42:55 410","exec":"1","self":"1","class":"PoolingHttpClientConnectionManager","api":"HTTP_CLIENT_4","agentId":"yunbaoParkApp4","agentName":"yunbaoParkApp","hasChildren":false,"paddingLeft":120},{"name":"p-0-0-0-0-0-0-0","classStyle":"","trClass":"","tdClass":"",
      "method":"execute(org.apache.http.HttpRequest request, org.apache.http.HttpClientConnection conn, org.apache.http.protocol.HttpContext context)","params":"/agencyBookKeep/tfPassbalancesheetcs/getOneAccountsReceivableData","startTimeStr":"17:42:55 411","exec":"15","self":"15","class":"HttpRequestExecutor","api":"HTTP_CLIENT_4","agentId":"yunbaoParkApp4","agentName":"yunbaoParkApp","hasChildren":true,"paddingLeft":120},{"name":"p-0-0-0-0-0-0-0-0","classStyle":"info","trClass":"","tdClass":"","method":"http.entity","params":"site=%E6%B3%89%E5%B7%9E%E5%85%AC%E8%B7%AF%E6%B8%AF\u0026token=f137b0ee205951530633bced8686abc2_9723969\u0026companyname=%E6%99%8B%E6%B1%9F%E5%B8%82%E7%95%85%E7%87%83%E7%89%A9%E6%B5%81%E6%9C%89%E9%99%90%E5%85%AC%E5%8F%B8","startTimeStr":"","exec":"","self":"","class":"","api":"","agentId":"","agentName":"","hasChildren":false,"paddingLeft":140},{"name":"p-0-0-0-0-0-0-0-0","classStyle":"info","trClass":"","tdClass":"","method":"http.status.code","params":"","startTimeStr":"","exec":"","self":"","class":"","api":"","agentId":"","agentName":"","hasChildren":false,"paddingLeft":140},{"name":"p-0-0-0-0-0-0-0-0","classStyle":"info","trClass":"","tdClass":"","method":"http.io","params":"write=0, read=14","startTimeStr":"","exec":"","self":"","class":"","api":"","agentId":"","agentName":"","hasChildren":false,"paddingLeft":140},{"name":"p-0-0-0-0-0-0-0","classStyle":"hand","trClass":"checktr","tdClass":"","method":"Tomcat Servlet Process","params":"/agencyBookKeep/tfPassbalancesheetcs/getOneAccountsReceivableData","startTimeStr":"17:42:55 414","exec":"10","self":"0","class":"","api":"TOMCAT","agentId":"agencyBookKeep3","agentName":"agencyBookKeep","hasChildren":true,"paddingLeft":120},{"name":"p-0-0-0-0-0-0-0-0","classStyle":"info","trClass":"","tdClass":"","method":"REMOTE_ADDRESS","params":"127.0.0.1","startTimeStr":"","exec":"","self":"","class":"","api":"","agentId":"","agentName":"","hasChildren":false,"paddingLeft":140},{"name":"p-0-0-0-0-0-0-0-0","classStyle":"","trClass":"","tdClass":"","method":"invoke(org.apache.catalina.connector.Request request, org.apache.catalina.connector.Response response)","params":"","startTimeStr":"17:42:55 414","exec":"10","self":"0","class":"StandardHostValve","api":"TOMCAT_METHOD","agentId":"agencyBookKeep3","agentName":"agencyBookKeep","hasChildren":true,"paddingLeft":140},{"name":"p-0-0-0-0-0-0-0-0-0","classStyle":"info","trClass":"","tdClass":"","method":"http.param","params":"site=泉州公路港\u0026token=f137b0ee205951530633bced8686abc2_9723969\u0026companyname=晋江市畅燃物流有限公司","startTimeStr":"","exec":"","self":"","class":"","api":"","agentId":"","agentName":"","hasChildren":false,"paddingLeft":160},{"name":"p-0-0-0-0-0-0-0-0-0","classStyle":"","trClass":"","tdClass":"","method":"doPost(javax.servlet.http.HttpServletRequest request, javax.servlet.http.HttpServletResponse response)","params":"","startTimeStr":"17:42:55 414","exec":"10","self":"0","class":"FrameworkServlet","api":"SPRING","agentId":"agencyBookKeep3","agentName":"agencyBookKeep","hasChildren":true,"paddingLeft":160},{"name":"p-0-0-0-0-0-0-0-0-0-0","classStyle":"","trClass":"","tdClass":"","method":"getOneAccountsReceivableData()","params":"","startTimeStr":"17:42:55 414","exec":"10","self":"2","class":"TfPassbalancesheetc","api":"SPRING_BEAN","agentId":"agencyBookKeep3","agentName":"agencyBookKeep","hasChildren":true,"paddingLeft":180},{"name":"p-0-0-0-0-0-0-0-0-0-0-0","classStyle":"","trClass":"","tdClass":"","method":"getOneAccountsReceivableData(java.util.Map map)","params":"","startTimeStr":"17:42:55 414","exec":"8","self":"0","class":"TfPassBalanceSheetServiceImpl","api":"SPRING_BEAN","agentId":"agencyBookKeep3","agentName":"agencyBookKeep","hasChildren":true,"paddingLeft":200},{"name":"p-0-0-0-0-0-0-0-0-0-0-0-0","classStyle":"error","trClass":"errortr","tdClass":"errortd","method":"org.springframework.jdbc.BadSqlGrammarException","params":"\n### Error querying database.  Cause: com.mysql.jdbc.exceptions.jdbc4.MySQLSyntaxErrorException: Table 'tfPass.TfPassBalanceSheet' doesn't exist\n### The error may exist in mapper/TfPassBalanceSheet.xml\n### The error may involve tf56.agencybookkeep.dao.TfPa...(879)","startTimeStr":"","exec":"","self":"","class":"","api":"","agentId":"","agentName":"","hasChildren":false,"paddingLeft":220},{"name":"p-0-0-0-0-0-0-0-0-0-0-0-0","classStyle":"","trClass":"","tdClass":"","method":"getOneAccountsReceivableData(java.util.Map map)","params":"","startTimeStr":"17:42:55 414","exec":"8","self":"0","class":"TfPassBalanceSheetDaoImpl","api":"SPRING_BEAN","agentId":"agencyBookKeep3","agentName":"agencyBookKeep","hasChildren":true,"paddingLeft":220},{"name":"p-0-0-0-0-0-0-0-0-0-0-0-0-0","classStyle":"error","trClass":"errortr","tdClass":"errortd","method":"org.springframework.jdbc.BadSqlGrammarException","params":"\n### Error querying database.  Cause: com.mysql.jdbc.exceptions.jdbc4.MySQLSyntaxErrorException: Table 'tfPass.TfPassBalanceSheet' doesn't exist\n### The error may exist in mapper/TfPassBalanceSheet.xml\n### The error may involve tf56.agencybookkeep.dao.TfPa...(879)","startTimeStr":"","exec":"","self":"","class":"","api":"","agentId":"","agentName":"","hasChildren":false,"paddingLeft":240},{"name":"p-0-0-0-0-0-0-0-0-0-0-0-0-0","classStyle":"","trClass":"","tdClass":"","method":"selectList(java.lang.String statement, java.lang.Object parameter)","params":"getOneAccountsReceivableData","startTimeStr":"17:42:55 414","exec":"8","self":"7","class":"SqlSessionTemplate","api":"MYBATIS","agentId":"agencyBookKeep3","agentName":"agencyBookKeep","hasChildren":true,"paddingLeft":240},{"name":"p-0-0-0-0-0-0-0-0-0-0-0-0-0-0","classStyle":"error","trClass":"errortr","tdClass":"errortd","method":"org.springframework.jdbc.BadSqlGrammarException","params":"\n### Error querying database.  Cause: com.mysql.jdbc.exceptions.jdbc4.MySQLSyntaxErrorException: Table 'tfPass.TfPassBalanceSheet' doesn't exist\n### The error may exist in mapper/TfPassBalanceSheet.xml\n### The error may involve tf56.agencybookkeep.dao.TfPa...(879)","startTimeStr":"","exec":"","self":"","class":"","api":"","agentId":"","agentName":"","hasChildren":false,"paddingLeft":260},{"name":"p-0-0-0-0-0-0-0-0-0-0-0-0-0-0","classStyle":"","trClass":"","tdClass":"","method":"prepareStatement(java.lang.String sql)","params":"","startTimeStr":"17:42:55 421","exec":"0","self":"0","class":"ConnectionImpl","api":"MYSQL","agentId":"agencyBookKeep3","agentName":"agencyBookKeep","hasChildren":true,"paddingLeft":260},{"name":"p-0-0-0-0-0-0-0-0-0-0-0-0-0-0-0","classStyle":"sql","trClass":"","tdClass":"","method":"SQL-ID","params":"select yingShouZhangKuan,yingFuZhangKuan,tfPassBalanceSheetId,taxPeriod,site,companyName from TfPassBalanceSheet Where isDeleted=\"0#\" and companyName=?  and site=? GROUP BY taxPeriod ORDER BY taxPeriod DESC LIMIT 1#","startTimeStr":"","exec":"","self":"","class":"","api":"","agentId":"","agentName":"","hasChildren":false,"paddingLeft":280},{"name":"p-0-0-0-0-0-0-0-0-0-0-0-0-0-0-0","classStyle":"info","trClass":"","tdClass":"","method":"SQL-BindValue","params":"0,1","startTimeStr":"","exec":"","self":"","class":"","api":"","agentId":"","agentName":"","hasChildren":false,"paddingLeft":280},{"name":"p-0-0-0-0-0-0-0-0-0-0-0-0-0-0","classStyle":"","trClass":"","tdClass":"","method":"execute()","params":"","startTimeStr":"17:42:55 421","exec":"1","self":"1","class":"PreparedStatement","api":"MYSQL","agentId":"agencyBookKeep3","agentName":"agencyBookKeep","hasChildren":true,"paddingLeft":260},{"name":"p-0-0-0-0-0-0-0-0-0-0-0-0-0-0-0","classStyle":"sql","trClass":"","tdClass":"","method":"SQL-ID","params":"select yingShouZhangKuan,yingFuZhangKuan,tfPassBalanceSheetId,taxPeriod,site,companyName from TfPassBalanceSheet Where isDeleted=\"0#\" and companyName=?  and site=? GROUP BY taxPeriod ORDER BY taxPeriod DESC LIMIT 1#","startTimeStr":"","exec":"","self":"","class":"","api":"","agentId":"","agentName":"","hasChildren":false,"paddingLeft":280},{"name":"p-0-0-0-0-0-0-0-0-0-0-0-0-0-0-0","classStyle":"info","trClass":"","tdClass":"","method":"SQL-BindValue","params":"0,1","startTimeStr":"","exec":"","self":"","class":"","api":"","agentId":"","agentName":"","hasChildren":false,"paddingLeft":280},{"name":"p-0-0-0-0-0-0-0-0-0-0-0-0-0-0-0","classStyle":"info","trClass":"","tdClass":"","method":"SQL-BindValue","params":"晋江市畅燃物流有限公司, 泉州公路港","startTimeStr":"","exec":"","self":"","class":"","api":"","agentId":"","agentName":"","hasChildren":false,"paddingLeft":280},{"name":"p-0-0-0-0-0-0-0-0-0-0-0-0-0-0-0","classStyle":"error","trClass":"errortr","tdClass":"errortd","method":"com.mysql.jdbc.exceptions.jdbc4.MySQLSyntaxErrorException","params":"Table 'tfPass.TfPassBalanceSheet' doesn't exist","startTimeStr":"","exec":"","self":"","class":"","api":"","agentId":"","agentName":"","hasChildren":false,"paddingLeft":280}],"success":true,"message":"","code":0}`,
      resultLimit: 20,
      selectedTraces: [],

      traceLabels: [
            {
                title: '发生时间',
                key: 'showTime',
                width: 200
            },
            {
                title: 'API',
                key: 'url'
            },
             {
                title: '耗时(ms)',
                key: 'elapsed',
                width: 100
            },
            {
                title: '服务器ID',
                key: 'agentId',
                width: 250
            },
            {
                title: '链路ID',
                key: 'traceId'
            },

        ],

      selSucCount: 0,
      selErrCount: 0
    }
  },
  watch: {
  },
  computed: {

  },
  methods: {
    rowClassName (row, index) {
                if (row.errCode == 1) {
                    return 'error-trace';
                } else  {
                    return 'success-trace';
                }
            },
    selectTraces(t) {
      this.selectedTraces = t
      for (var i=0;i<t.length;i++) {
        if (t[i].errCode==1) {
          this.selErrCount++
        } else {
          this.selSucCount++
        }
      }
    },
    showTrace(t) {
      console.log(JSON.parse(this.testTraceData))
    }
  },
  mounted() {
    // 获取testTraceData
    axios({
          method: "get",
          url: 'http://10.33.117.12/openapm/apmTraceIdInfo',
          params: {
            traceId : 'yunbaoParkApp4^5E1545036646685^5E3989',
            agentId : 'agencyBookKeep3',
            startTime : '1545212575414'
          },
          withCredentials: true
        })
        .then(function(res) {
           console.log(res)
        })
        .catch(function(err) {
          gdata.error(par, err);
        });
  }
}
</script>

</style>

<style lang="less" scoped> 
@import "../../theme/gvar.less";
</style>

<style>
    .ivu-table .error-trace td{
        background-color: rgba(223, 83, 83, .5);
        color: #333;
    }
    .ivu-table td:hover {
      cursor: pointer;
    }
</style>